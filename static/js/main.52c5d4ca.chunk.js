(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{173:function(e,t,n){e.exports=n(197)},178:function(e,t,n){},180:function(e,t,n){},197:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(24),u=n.n(r),c=(n(178),n(30)),s=n(26),i=n(101),l=n(93),h=n(102),p=n(67),f=n(248),d=(n(180),n(198)),y=n(97),m=n(64),g=n(130),b=n(131),v=n(108),k=n(104),j=n(154),O=n(237),S=(n(181),n(153)),w=n(149),R=n(18),H=n(128),C=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"createMap",value:function(e){return new w.a(e)}},{key:"createView",value:function(e){return new H.a(e)}},{key:"createControls",value:function(e){return Object(S.a)(e)}},{key:"lngLatTo3857",value:function(e){return Object(R.g)(e,"EPSG:4326","EPSG:3857")}}]),e}(),E={},x=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"createHouseFeatures",value:function(e){var t=[],n=!0,o=!1,a=void 0;try{for(var r,u=e[Symbol.iterator]();!(n=(r=u.next()).done);n=!0){var c=r.value,s=c.position,i=C.lngLatTo3857([s[1],s[0]]),l=new y.a(new m.a(i));l.setProperties({house:c}),t.push(l)}}catch(h){o=!0,a=h}finally{try{n||null==u.return||u.return()}finally{if(o)throw a}}return t}},{key:"clusterFeatureStyle",value:function(t){var n=t.get("features"),o=n.length,a=!!n.find(function(e){return e.getProperties().house.indexInRoute>-1}),r=-1,u=o.toString(),c="#3399CC";if(1===o){var s=n[0].getProperties().house;c=s.zoneColor,u=(r=s.indexInRoute)>-1?(r+1).toString():""}var i=E["".concat(o,"_").concat(a,"_").concat(r)];return i||(i=new g.b({image:1===o?e.createSquare(c,a):e.createCircle(a),text:e.createText(u)}),E[o]=i),i}},{key:"createCircle",value:function(e){var t=e?"#ffcc80":"#fff";return new b.a({radius:15,stroke:new v.a({width:2,color:"#3399CC"}),fill:new k.a({color:t})})}},{key:"createSquare",value:function(e,t){var n=t?"#ffcc80":"#fff";return new j.a({points:4,radius1:15,angle:Math.PI/2,stroke:new v.a({width:2,color:e}),fill:new k.a({color:n})})}},{key:"createText",value:function(e){return new O.a({font:'bold 11px "Open Sans", "Arial Unicode MS", "sans-serif"',text:e,fill:new k.a({color:"#333"})})}}]),e}(),D=n(151),T=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"createRouteFeatures",value:function(e){var t=e.map(function(e){return{type:"Feature",geometry:{coordinates:e.latLngs.map(function(e){return C.lngLatTo3857(e.slice().reverse())}),type:"LineString"}}});return(new D.a).readFeatures({type:"FeatureCollection",features:t})}},{key:"routeFeatureStyle",value:function(e){return new g.b({stroke:new v.a({lineDash:[4],color:"green",width:2})})}}]),e}(),V=n(251),F=n(238),P=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"createTileLayer",value:function(e){return new V.a({source:e})}},{key:"createVectorLayer",value:function(e,t){return new F.a({source:e,style:function(e){return t(e)}})}}]),e}(),I=n(152),B=n(239),M=n(150),L=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"createXYZSource",value:function(e){return new M.a(e)}},{key:"createVectorSource",value:function(e){return new I.a({features:e})}},{key:"createClusterSource",value:function(e,t){return new B.a({distance:t,source:e})}}]),e}(),z=n(139),_=n.n(z),U=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"getRoute",value:function(e){var t={coordinates:e.map(function(e){return e.slice().reverse().join(",")}).join(";"),overview:"full"},n=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),o=new URL("".concat("https://api.mapbox.com/directions/v5/mapbox/walking","?access_token=").concat("pk.eyJ1IjoiYnVyb3Z5YSIsImEiOiJjanVucnE3bHMweHRlM3pvNXAycXllaHl5In0.ytKUDnITJq8JScaXHW3qzQ"));return fetch(o,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:n}).then(function(e){return e.json()}).then(function(e){return e.routes.map(function(e){return{latLngs:_.a.decode(e.geometry),distance:e.distance}})})}}]),e}(),J=Object(d.a)("div")({height:"100%"}),q=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(l.a)(t).call(this,e))).map=null,n._initMap(),n.mapContainer=a.a.createRef(),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"_initMap",value:function(){var e=this,t=C.createView({center:C.lngLatTo3857([37.618423,55.751244]),zoom:8}),n=C.createControls({zoom:!1}),o=L.createXYZSource({url:"http://{a-c}.tilessputnik.ru/{z}/{x}/{y}.png",opaque:!1,attributions:['<a href="https://maps.sputnik.ru">\u0421\u043f\u0443\u0442\u043d\u0438\u043a</a>',"\xa9 \u0420\u043e\u0441\u0442\u0435\u043b\u0435\u043a\u043e\u043c"]}),a=P.createTileLayer(o),r=L.createVectorSource([]),u=L.createClusterSource(r,40),c=P.createVectorLayer(u,x.clusterFeatureStyle);this.houseSource=r;var s=L.createVectorSource([]),i=P.createVectorLayer(s,T.routeFeatureStyle);this.routeSource=s,this.map=C.createMap({layers:[a,c,i],target:null,controls:n,view:t}),this.map.on("click",function(t){e.map.forEachFeatureAtPixel(t.pixel,function(t,n){var o=t.get("features");if(o&&1===o.length){var a=o[0].getProperties().house;a.indexInRoute>-1?e.props.removeHouseFromRoute(a):e.props.addHouseToRoute(a);var r=e.props.getRouteHouses();r.length>1?U.getRoute(r.map(function(e){return e.position})).then(function(t){e.props.setRouteData(t)}):e.props.setRouteData(null),t.setStyle(function(e){return x.clusterFeatureStyle(e)})}})})}},{key:"_addHousesToMap",value:function(){this.houseSource.clear(),this.houseSource.addFeatures(x.createHouseFeatures(this.props.houses))}},{key:"_addRouteToMap",value:function(){this.routeSource.clear(),this.props.routeData&&this.routeSource.addFeatures(T.createRouteFeatures(this.props.routeData))}},{key:"render",value:function(){return a.a.createElement(J,{ref:this.mapContainer})}},{key:"componentDidMount",value:function(){this.map.setTarget(this.mapContainer.current),this._addHousesToMap()}},{key:"componentDidUpdate",value:function(){this._addHousesToMap(),this._addRouteToMap()}}]),t}(o.Component),X=Object(p.b)("houseStore","toolbarStore")(Object(p.c)(function(e){var t=e.houseStore,n=e.toolbarStore;return a.a.createElement(q,{houses:t.houses.filter(function(e){return e.zone.name.includes(n.searchValueDelayed)}),addHouseToRoute:function(e){return t.addHouseToRoute(e)},removeHouseFromRoute:function(e){return t.removeHouseFromRoute(e)},getRouteHouses:function(){return t.getRouteHouses()},routeData:t.routeData,setRouteData:function(e){t.setRouteData(e)}})})),A=n(70),Y=n(243),G=n(244),W=n(143),Z=n.n(W),K=n(142),N=n.n(K),Q=n(144),$=n.n(Q),ee=n(247),te=Object(d.a)(ee.a)({marginTop:0,marginLeft:"16px"}),ne=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(i.a)(this,Object(l.a)(t).call(this,e))).searchValueChangeTimeout=null,n.handleSearchValueChange=n.handleSearchValueChange.bind(Object(A.a)(n)),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.a.createElement(Y.a,null,a.a.createElement(G.a,{edge:"start",color:"inherit","aria-label":"Menu",title:this.props.menuButtonPushed?"\u0421\u043a\u0440\u044b\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u043c\u043e\u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430":"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0434\u043e\u043c\u043e\u0432 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430",onClick:this.props.menuButtonClick},this.props.menuButtonPushed?a.a.createElement(N.a,null):a.a.createElement(Z.a,null)),a.a.createElement(G.a,{color:"inherit","aria-label":"Menu",title:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u043c\u0430\u0440\u0448\u0440\u0443\u0442",onClick:this.props.clearButtonClick},a.a.createElement($.a,null)),a.a.createElement(te,{label:"\u0424\u0438\u043b\u044c\u0442\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0443\u0447\u0430\u0441\u0442\u043a\u0430\u043c",type:"search",margin:"normal",value:this.props.searchValue,onChange:this.handleSearchValueChange}))}},{key:"handleSearchValueChange",value:function(e){this.props.onChange(e)}}]),t}(o.Component),oe=Object(p.b)("toolbarStore","houseStore")(Object(p.c)(function(e){var t=e.toolbarStore,n=e.houseStore;return a.a.createElement(ne,{menuButtonPushed:t.menuButtonPushed,menuButtonClick:function(){return t.toggle()},clearButtonClick:function(){return n.clearRoute()},searchValue:t.searchValue,onChange:function(e){t.setSearchValue(e.target.value)}})})),ae=n(250),re=n(145),ue=n(242),ce=n(245),se=n(252),ie=n(246),le=n(146),he=n.n(le),pe=Object(re.a)(ue.a)(function(e){return{width:460,backgroundColor:e.theme.palette.background.paper}}),fe=function(e){var t=0,n=e.houses.map(function(e){return a.a.createElement(ce.a,{alignItems:"flex-start",key:t++},a.a.createElement("div",{style:{backgroundColor:e.zoneColor,flex:"0 0 50px",textAlign:"center",marginTop:"16px",marginRight:"16px",padding:"4px",borderRadius:"4px",color:"#fff"}},e.zone.name),a.a.createElement(se.a,{primary:e.address,secondary:"\u0414\u0430\u0442\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0439 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: "+e.date}),a.a.createElement(ie.a,null,a.a.createElement(he.a,null)))});return a.a.createElement(ae.a,{anchor:"left",variant:"persistent",open:e.visible,PaperProps:{style:{position:"absolute"}}},a.a.createElement(pe,null,a.a.createElement(ce.a,{alignItems:"center",key:"no-data"},a.a.createElement(se.a,{primary:"\u0414\u043b\u0438\u043d\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430: ".concat(e.routeDistance," \u043c")})),0===n.length&&a.a.createElement(ce.a,{alignItems:"center",key:"no-data"},a.a.createElement(se.a,{primary:"\u041d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0434\u043e\u043c\u0430 \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e"})),n))},de=Object(p.b)("houseStore","toolbarStore")(Object(p.c)(function(e){var t=e.houseStore,n=e.toolbarStore;return a.a.createElement(fe,{visible:n.menuButtonPushed,houses:t.routeHouses.slice(),routeDistance:t.routeDistance})})),ye=n(20),me=n(147),ge=n.n(me),be=n(148),ve={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.55946636199951,55.72019767205755],[37.57766246795654,55.72019767205755],[37.57766246795654,55.72749675732418],[37.55946636199951,55.72749675732418],[37.55946636199951,55.72019767205755]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.56800651550293,55.728946744262515],[37.588176727294915,55.728946744262515],[37.588176727294915,55.73643748562126],[37.56800651550293,55.73643748562126],[37.56800651550293,55.728946744262515]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.5787353515625,55.73745224969486],[37.60148048400879,55.73745224969486],[37.60148048400879,55.745762657730495],[37.5787353515625,55.745762657730495],[37.5787353515625,55.73745224969486]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.60894775390625,55.72068109737315],[37.63649940490723,55.72068109737315],[37.63649940490723,55.73087997641518],[37.60894775390625,55.73087997641518],[37.60894775390625,55.72068109737315]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.59864807128906,55.70873874051673],[37.62825965881348,55.70873874051673],[37.62825965881348,55.71981092749662],[37.59864807128906,55.71981092749662],[37.59864807128906,55.70873874051673]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.61152267456054,55.732474820874856],[37.638559341430664,55.732474820874856],[37.638559341430664,55.74440992120792],[37.61152267456054,55.74440992120792],[37.61152267456054,55.732474820874856]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.57890701293945,55.69026199416489],[37.61838912963867,55.69026199416489],[37.61838912963867,55.70419291679782],[37.57890701293945,55.70419291679782],[37.57890701293945,55.69026199416489]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.53650665283203,55.68910085982751],[37.57238388061523,55.68910085982751],[37.57238388061523,55.704579816001036],[37.53650665283203,55.704579816001036],[37.53650665283203,55.68910085982751]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.57495880126953,55.7517527843269],[37.60465621948242,55.7517527843269],[37.60465621948242,55.76537206761647],[37.57495880126953,55.76537206761647],[37.57495880126953,55.7517527843269]]]}},{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[37.54199981689453,55.75532709909638],[37.57169723510742,55.75532709909638],[37.57169723510742,55.76788290546831],[37.54199981689453,55.76788290546831],[37.54199981689453,55.75532709909638]]]}}]},ke=function(){function e(){Object(c.a)(this,e)}return Object(s.a)(e,null,[{key:"getTestData",value:function(){var e=[],t=1;return ve.features.forEach(function(n){var o=ge()(n),a=Object(be.randomPoint)(50,{bbox:o}),r=1;a.features.forEach(function(n){e.push({address:"<\u0413\u043e\u0440\u043e\u0434> <\u0423\u043b\u0438\u0446\u0430> <\u0414\u043e\u043c> ".concat(r),position:n.geometry.coordinates.slice().reverse(),date:"22.07.2014",zone:{name:"C\u042d-".concat(t),chief:{name:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f \u0418\u043c\u044f \u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e",photo:""}}}),r++}),t++}),e}}]),e}(),je=function(){function e(){Object(c.a)(this,e),this.houses=[],this.routeHouses=[],this.routeData=null,this.houses=[],this.routeHouses=[],this.routeData=null,this.putHouses(ke.getTestData())}return Object(s.a)(e,[{key:"getHouses",value:function(e){return this.houses.filter(function(t){return t.zone.name.includes(e)})}},{key:"putHouses",value:function(e){var t=["#f44336","#9c27b0","#3f51b5","#03a9f4","#009688","#8bc34a","#ffeb3b","#ff9800","#795548","#607d8b"],n={},o=[];e.forEach(function(e){e.indexInRoute=-1;var a=e.zone.name;n[a]||(n[a]=t.pop()||"#607d8b"),e.zoneColor=n[a],o.push(Object(ye.k)(e))}),this.houses=o}},{key:"addHouseToRoute",value:function(e){this.routeHouses.includes(e)||(e.indexInRoute=this.routeHouses.length,this.routeHouses.push(e))}},{key:"removeHouseFromRoute",value:function(e){if(-1!==e.indexInRoute&&e.indexInRoute<this.routeHouses.length){this.routeHouses.splice(e.indexInRoute,1);for(var t=e.indexInRoute;t<this.routeHouses.length;++t)this.routeHouses[t].indexInRoute=t;e.indexInRoute=-1}}},{key:"getRouteHouses",value:function(){return this.routeHouses}},{key:"clearRoute",value:function(){this.routeHouses.forEach(function(e){e.indexInRoute=-1}),this.routeHouses.splice(0,this.routeHouses.length),this.routeData=null}},{key:"setRouteData",value:function(e){this.routeData=e}},{key:"routeDistance",get:function(){var e=0;return this.routeData&&this.routeData.forEach(function(t){e+=t.distance}),e}}]),e}();Object(ye.f)(je,{houses:ye.k,routeHouses:ye.k,routeData:ye.k,fetch:ye.b,putHouses:ye.b,addHouseToRoute:ye.b,removeHouseFromRoute:ye.b,getRouteHouses:ye.b,getHouses:ye.b,clearRoute:ye.b,setRouteData:ye.b,routeDistance:ye.c});var Oe=new je,Se=function(){function e(){Object(c.a)(this,e),this.menuButtonPushed=!1,this.searchValue="",this.searchValueDelayed="",this.menuButtonPushed=!0,this.searchValue="",this.searchValueDelayed="",this.searchValueDelayedTimeout=null}return Object(s.a)(e,[{key:"toggle",value:function(){this.menuButtonPushed=!this.menuButtonPushed}},{key:"setSearchValue",value:function(e){var t=this;this.searchValue=e,this.searchValueDelayedTimeout&&clearTimeout(this.searchValueDelayedTimeout),this.searchValueDelayedTimeout=setTimeout(function(){t.searchValueDelayed=e},500)}}]),e}();Object(ye.f)(Se,{searchValue:ye.k,searchValueDelayed:ye.k,menuButtonPushed:ye.k,setSearchValue:ye.b,toggle:ye.b});var we=new Se,Re={height:"100%"},He={position:"relative"},Ce={houseStore:Oe,toolbarStore:we},Ee=function(e){function t(){return Object(c.a)(this,t),Object(i.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.a.createElement(p.a,Ce,a.a.createElement(f.a,{display:"flex",flexDirection:"column",justify:"flex-start",alignItems:"stretch",style:Re},a.a.createElement(f.a,null,a.a.createElement(oe,null)),a.a.createElement(f.a,{flexGrow:1,minHeight:0,style:He},a.a.createElement(de,null),a.a.createElement(X,null))))}}]),t}(o.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(a.a.createElement(Ee,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[173,1,2]]]);
//# sourceMappingURL=main.52c5d4ca.chunk.js.map